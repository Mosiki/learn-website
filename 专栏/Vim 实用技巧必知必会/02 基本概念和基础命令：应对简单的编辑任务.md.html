<!DOCTYPE html>
<!-- saved from url=(0046)https://kaiiiz.github.io/hexo-theme-book-demo/ -->
<html xmlns="http://www.w3.org/1999/xhtml">

<head>

    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">
        <link rel="icon" href="../../static/favicon.png">
        <title>02 基本概念和基础命令：应对简单的编辑任务.md</title>
        <!-- Spectre.css framework -->
        <link rel="stylesheet" href="../../static/index.css">
        <link rel="stylesheet"
              href="../../static/highlight.min.css">
        <script src="../../static/highlight.min.js"></script>
        <!-- theme css & js -->
        <meta name="generator" content="Hexo 4.2.0">
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5295275829820252"
                crossorigin="anonymous"></script>
        <script async defer data-website-id="83e5d5db-9d06-40e3-b780-cbae722fdf8c" src="https://analyze.lianglianglee.com/umami.js"></script>
    </head>

<body>

    <div class="book-container">
        <div class="book-sidebar">
            <div class="book-brand">
                <a href="../../index.html">
                    <img src="../../static/favicon.png">
                    <span>技术文章摘抄</span>
                </a>
            </div>
            <div class="book-menu uncollapsible">
                <ul class="uncollapsible">
                    <li><a href="../../index.html" class="current-tab">首页</a></li>
                </ul>

                <ul class="uncollapsible">
                    <li><a href="../index.html">上一级</a></li>
                </ul>

                <ul class="uncollapsible">
                    <li>

                        
                        <a href="00%20%E5%AF%BC%E8%AF%BB%20%E6%B1%A0%E5%BB%BA%E5%BC%BA%EF%BC%9AVim%20%E5%B0%B1%E6%98%AF%E5%9B%9B%E4%B8%AA%E5%AD%97%E2%80%9C%E5%94%AF%E5%BF%AB%E4%B8%8D%E7%A0%B4%E2%80%9D.md.html">00 导读 池建强：Vim 就是四个字“唯快不破”.md</a>

                    </li>
                    <li>

                        
                        <a href="00%20%E5%BC%80%E7%AF%87%E8%AF%8D%20%E6%88%91%E4%BB%AC%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%AD%A6%20Vim%EF%BC%9F.md.html">00 开篇词 我们为什么要学 Vim？.md</a>

                    </li>
                    <li>

                        
                        <a href="01%20%E5%90%84%E5%B9%B3%E5%8F%B0%E4%B8%8B%E7%9A%84%20Vim%20%E5%AE%89%E8%A3%85%E6%96%B9%E6%B3%95%EF%BC%9A%E4%B8%8A%E8%B7%AF%E5%89%8D%E5%87%86%E5%A4%87%E5%A5%BD%E4%BD%A0%E7%9A%84%E5%AE%9D%E9%A9%AC.md.html">01 各平台下的 Vim 安装方法：上路前准备好你的宝马.md</a>

                    </li>
                    <li>

                        <a class="current-tab" href="02%20%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4%EF%BC%9A%E5%BA%94%E5%AF%B9%E7%AE%80%E5%8D%95%E7%9A%84%E7%BC%96%E8%BE%91%E4%BB%BB%E5%8A%A1.md.html">02 基本概念和基础命令：应对简单的编辑任务.md</a>
                        

                    </li>
                    <li>

                        
                        <a href="03%20%E6%9B%B4%E5%A4%9A%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%EF%BC%9A%E5%BA%94%E5%AF%B9%E7%A8%8D%E5%A4%8D%E6%9D%82%E7%9A%84%E7%BC%96%E8%BE%91%E4%BB%BB%E5%8A%A1.md.html">03 更多常用命令：应对稍复杂的编辑任务.md</a>

                    </li>
                    <li>

                        
                        <a href="04%20%E5%88%9D%E6%AD%A5%E5%AE%9A%E5%88%B6%EF%BC%9A%E8%AE%A9%E4%BD%A0%E7%9A%84%20Vim%20%E6%9B%B4%E9%A1%BA%E6%89%8B.md.html">04 初步定制：让你的 Vim 更顺手.md</a>

                    </li>
                    <li>

                        
                        <a href="05%20%E5%A4%9A%E6%96%87%E4%BB%B6%E6%89%93%E5%BC%80%E4%B8%8E%E7%BC%93%E5%86%B2%E5%8C%BA%EF%BC%9A%E5%A4%8D%E5%88%B6%E7%B2%98%E8%B4%B4%E7%9A%84%E6%AD%A3%E7%A1%AE%E5%A7%BF%E5%8A%BF.md.html">05 多文件打开与缓冲区：复制粘贴的正确姿势.md</a>

                    </li>
                    <li>

                        
                        <a href="06%20%E7%AA%97%E5%8F%A3%E5%92%8C%E6%A0%87%E7%AD%BE%E9%A1%B5%EF%BC%9A%E4%BF%AE%E6%94%B9%E3%80%81%E5%AF%B9%E6%AF%94%E5%A4%9A%E4%B8%AA%E6%96%87%E4%BB%B6%E7%9A%84%E6%AD%A3%E7%A1%AE%E5%A7%BF%E5%8A%BF.md.html">06 窗口和标签页：修改、对比多个文件的正确姿势.md</a>

                    </li>
                    <li>

                        
                        <a href="07%20%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%EF%BC%9A%E5%AE%9E%E7%8E%B0%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9%E7%9A%84%E6%90%9C%E7%B4%A2%E5%92%8C%E6%9B%BF%E6%8D%A2.md.html">07 正则表达式：实现文件内容的搜索和替换.md</a>

                    </li>
                    <li>

                        
                        <a href="08%20%E5%9F%BA%E6%9C%AC%E7%BC%96%E7%A8%8B%E6%94%AF%E6%8C%81%EF%BC%9A%E8%A7%84%E9%81%BF%E3%80%81%E8%A7%A3%E5%86%B3%E7%BC%96%E7%A8%8B%E6%97%B6%E7%9A%84%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98.md.html">08 基本编程支持：规避、解决编程时的常见问题.md</a>

                    </li>
                    <li>

                        
                        <a href="09%20%E4%B8%83%E5%A4%A7%E5%B8%B8%E7%94%A8%E6%8A%80%E5%B7%A7%EF%BC%9A%E8%AE%A9%E7%BC%96%E8%BE%91%E6%95%88%E7%8E%87%E5%86%8D%E4%B8%8A%E4%B8%80%E4%B8%AA%E5%8F%B0%E9%98%B6.md.html">09 七大常用技巧：让编辑效率再上一个台阶.md</a>

                    </li>
                    <li>

                        
                        <a href="10%20%E4%BB%A3%E7%A0%81%E9%87%8D%E6%9E%84%E5%AE%9E%E9%AA%8C%EF%BC%9A%E5%9C%A8%E5%AE%9E%E6%88%98%E4%B8%AD%E6%8F%90%E9%AB%98%E7%BC%96%E8%BE%91%E7%86%9F%E7%BB%83%E5%BA%A6.md.html">10 代码重构实验：在实战中提高编辑熟练度.md</a>

                    </li>
                    <li>

                        
                        <a href="11%20%E6%96%87%E6%9C%AC%E7%9A%84%E7%BB%86%E8%8A%82%EF%BC%9A%E5%85%B3%E4%BA%8E%E5%AD%97%E7%AC%A6%E3%80%81%E7%BC%96%E7%A0%81%E3%80%81%E8%A1%8C%E4%BD%A0%E6%89%80%E9%9C%80%E8%A6%81%E7%9F%A5%E9%81%93%E7%9A%84%E4%B8%80%E5%88%87.md.html">11 文本的细节：关于字符、编码、行你所需要知道的一切.md</a>

                    </li>
                    <li>

                        
                        <a href="12%20%E8%AF%AD%E6%B3%95%E5%8A%A0%E4%BA%AE%E5%92%8C%E9%85%8D%E8%89%B2%E6%96%B9%E6%A1%88%EF%BC%9A%E9%A2%9C%E5%8D%B3%E6%AD%A3%E4%B9%89.md.html">12 语法加亮和配色方案：颜即正义.md</a>

                    </li>
                    <li>

                        
                        <a href="13%20YouCompleteMe%EF%BC%9AVim%20%E9%87%8C%E7%9A%84%E8%87%AA%E5%8A%A8%E5%AE%8C%E6%88%90.md.html">13 YouCompleteMe：Vim 里的自动完成.md</a>

                    </li>
                    <li>

                        
                        <a href="14%20Vim%20%E8%84%9A%E6%9C%AC%E7%AE%80%E4%BB%8B%EF%BC%9A%E5%BC%80%E5%A7%8B%E4%BD%A0%E7%9A%84%E6%B7%B1%E5%BA%A6%E5%AE%9A%E5%88%B6.md.html">14 Vim 脚本简介：开始你的深度定制.md</a>

                    </li>
                    <li>

                        
                        <a href="15%20%E6%8F%92%E4%BB%B6%E8%8D%9F%E8%90%83%EF%BC%9A%E4%B8%8D%E5%8F%AF%E6%88%96%E7%BC%BA%E7%9A%84%E6%8F%92%E4%BB%B6.md.html">15 插件荟萃：不可或缺的插件.md</a>

                    </li>
                    <li>

                        
                        <a href="16%20%E7%BB%88%E7%AB%AF%E5%92%8C%20GDB%20%E6%94%AF%E6%8C%81%EF%BC%9A%E4%B8%8D%E7%A6%BB%E5%BC%80%20Vim%20%E5%AE%8C%E6%88%90%E5%BC%80%E5%8F%91%E4%BB%BB%E5%8A%A1.md.html">16 终端和 GDB 支持：不离开 Vim 完成开发任务.md</a>

                    </li>
                    <li>

                        
                        <a href="%E6%8B%93%E5%B1%951%20%E7%BA%AF%E6%96%87%E6%9C%AC%E7%BC%96%E8%BE%91%EF%BC%9A%E4%BD%BF%E7%94%A8%20Vim%20%E4%B9%A6%E5%86%99%E4%B8%AD%E8%8B%B1%E6%96%87%E6%96%87%E6%A1%A3.md.html">拓展1 纯文本编辑：使用 Vim 书写中英文文档.md</a>

                    </li>
                    <li>

                        
                        <a href="%E6%8B%93%E5%B1%952%20C%20%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%20Vim%20%E5%B7%A5%E4%BD%9C%E7%8E%AF%E5%A2%83%EF%BC%9AC%20%E4%BB%A3%E7%A0%81%E7%9A%84%E6%90%9C%E7%B4%A2%E3%80%81%E6%8F%90%E7%A4%BA%E5%92%8C%E8%87%AA%E5%8A%A8%E5%AE%8C%E6%88%90.md.html">拓展2 C 程序员的 Vim 工作环境：C 代码的搜索、提示和自动完成.md</a>

                    </li>
                    <li>

                        
                        <a href="%E6%8B%93%E5%B1%953%20Python%20%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%20Vim%20%E5%B7%A5%E4%BD%9C%E7%8E%AF%E5%A2%83%EF%BC%9A%E5%AE%8C%E6%95%B4%E7%9A%84%20Python%20%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83.md.html">拓展3 Python 程序员的 Vim 工作环境：完整的 Python 开发环境.md</a>

                    </li>
                    <li>

                        
                        <a href="%E6%8B%93%E5%B1%954%20%E6%8F%92%E4%BB%B6%E6%A0%B7%E4%BE%8B%E5%88%86%E6%9E%90%EF%BC%9A%E8%87%AA%E5%B7%B1%E5%8A%A8%E6%89%8B%E6%94%B9%E8%BF%9B%E6%8F%92%E4%BB%B6.md.html">拓展4 插件样例分析：自己动手改进插件.md</a>

                    </li>
                    <li>

                        
                        <a href="%E6%8B%93%E5%B1%955%20%E5%85%B6%E4%BB%96%E6%8F%92%E4%BB%B6%E5%92%8C%E6%8A%80%E5%B7%A7%EF%BC%9A%E5%90%B4%E5%92%8F%E7%82%9C%E7%9A%84%E7%AE%B1%E5%BA%95%E7%A7%81%E8%97%8F.md.html">拓展5 其他插件和技巧：吴咏炜的箱底私藏.md</a>

                    </li>
                    <li>

                        
                        <a href="%E7%BB%93%E6%9D%9F%E8%AF%AD%20Vim%20%E6%A3%AE%E6%9E%97%E6%8E%A2%E7%A7%98%EF%BC%8C%E4%B8%80%E5%88%87%E6%89%8D%E5%88%9A%E5%88%9A%E5%BC%80%E5%A7%8B.md.html">结束语 Vim 森林探秘，一切才刚刚开始.md</a>

                    </li>
                </ul>

            </div>
        </div>

        <div class="sidebar-toggle" onclick="sidebar_toggle()" onmouseover="add_inner()" onmouseleave="remove_inner()">
            <div class="sidebar-toggle-inner"></div>
        </div>

        <script>
            function add_inner() {
                let inner = document.querySelector('.sidebar-toggle-inner')
                inner.classList.add('show')
            }

            function remove_inner() {
                let inner = document.querySelector('.sidebar-toggle-inner')
                inner.classList.remove('show')
            }

            function sidebar_toggle() {
                let sidebar_toggle = document.querySelector('.sidebar-toggle')
                let sidebar = document.querySelector('.book-sidebar')
                let content = document.querySelector('.off-canvas-content')
                if (sidebar_toggle.classList.contains('extend')) { // show
                    sidebar_toggle.classList.remove('extend')
                    sidebar.classList.remove('hide')
                    content.classList.remove('extend')
                } else { // hide
                    sidebar_toggle.classList.add('extend')
                    sidebar.classList.add('hide')
                    content.classList.add('extend')
                }
            }


            function open_sidebar() {
                let sidebar = document.querySelector('.book-sidebar')
                let overlay = document.querySelector('.off-canvas-overlay')
                sidebar.classList.add('show')
                overlay.classList.add('show')
            }
            function hide_canvas() {
                let sidebar = document.querySelector('.book-sidebar')
                let overlay = document.querySelector('.off-canvas-overlay')
                sidebar.classList.remove('show')
                overlay.classList.remove('show')
            }

        </script>

        <div class="off-canvas-content">
            <div class="columns">
                <div class="column col-12 col-lg-12">
                    <div class="book-navbar">
                        <!-- For Responsive Layout -->
                        <header class="navbar">
                            <section class="navbar-section">
                                <a onclick="open_sidebar()">
                                    <i class="icon icon-menu"></i>
                                </a>
                            </section>
                        </header>
                    </div>
                    <div class="book-content" style="max-width: 960px; margin: 0 auto;
    overflow-x: auto;
    overflow-y: hidden;">
                        <div class="book-post">
                            <p id="tip" align="center"></p>
                            <div><h1>02 基本概念和基础命令：应对简单的编辑任务</h1>
<p>你好，我是吴咏炜。</p>
<p>这一讲，我们会讨论 Vim 的基本概念和配置。先强调一下，请务必确保你在学习这一讲之前，已经通过 Vim 教程熟悉了 Vim 的基本用法。</p>
<h2>Vim 教程的内容概要</h2>
<p>上节课我给你留的作业，就是花时间学习一下 Vim 教程，下面我们就来检验一下。只有你自己先对照着教程操作了一遍，今天我再带着你过一遍里面的基本概念和配置，你才能查漏补缺，发现自己遇到的问题，明确自己需要多加练习的地方。</p>
<p>好，现在请查看下面的键盘图。简单说明一下，这张图上展示了一个键盘。图中的“•”表示，单个字母不是完整的命令，必须再有进一步的输入。比如，单个“g”没有意义，而“gg”表示跳转到文件开头。（对于命令后面明确跟一个动作的，如“c”，我们不使用“•”。）一个键最多有三排内容：最底下是直接按键的结果，中间是按下 Shift 的结果（变大写），上面偏右的小字是按下 Ctrl 的结果。我们还用了一些特殊符号来表示操作的位置，如果你已经了解了这些命令的功能，你也自然就明白它们的意义了。</p>
<p><img src="assets/76910d1a16ed737c42078dd1255124a1.png" alt="Fig2.1" title="Vim 命令速查（教程版）" /></p>
<p>请检查一下有颜色的那些键，看看你是否有任何不熟悉的地方。如果看下来有让你感到陌生的内容，请复习 Vim 教程。</p>
<p>这张图里没有写出 Vim 的命令行命令。你现在应该已经掌握了以下这些：</p>
<ul>
<li>“:q!”：退出 Vim</li>
<li>“:wq”：存盘退出</li>
<li>“:s”：执行替换</li>
<li>“:!”：执行外部命令</li>
<li>“:edit”（一般缩写为 “:e”）：编辑文件</li>
<li>“:w”：写文件</li>
<li>“:r”：读文件</li>
<li>“:help”：查看帮助</li>
<li>使用键 Ctrl-D 和 Tab 来进行命令行补全</li>
</ul>
<p>同样，如果你发现上面列举的命令有你不熟悉的，也请重新打开 Vim 教程复习一下——这些属于 Vim 的最基本功能，一定要能熟练运用才行。</p>
<h2>Vim 的模式</h2>
<p>接下来我们进入本讲的正题，讲述 Vim 的四种主要模式、键描述的体例和 Vim 需要的基本配置选项。掌握了这些内容之后，我们就能应对基本的编辑任务了。下面我们一一来看。</p>
<p>Vim 最特别的地方就是它的模式了。与其他大部分编辑器不同，进入 Vim 后，缺省状态下键入的字符并不会插入到所编辑的文件之中。 Vim 的模式（mode，可以简单地理解为“状态”）是它的麻烦所在，但同时也是它的威力所在。</p>
<p>我们需要知道，Vim 有以下四种主要模式:</p>
<ul>
<li>正常（normal）模式（也称为普通模式），缺省的编辑模式；如果不加特殊说明，一般提到的命令都直接在正常模式下输入；在任何其他模式中，都可以通过键盘上的 Esc 键回到正常模式。</li>
<li>插入（insert）模式，输入文本时使用；比如在正常模式下键入 i（insert）或 a（append）即可进入插入模式。</li>
<li>可视（visual）模式，用于选定文本块；教程中已经提到可以用键 v（小写）来按字符选定，Vim 里也提供其他不同的选定方法，包括按行和按列块。</li>
<li>命令行（command-line）模式，用于执行较长、较复杂的命令；在正常模式下键入冒号（:）即可进入该模式；使用斜杠（/）和问号（?）开始搜索也算作命令行模式。命令行模式下的命令要输入回车键（Enter）才算完成。</li>
</ul>
<p>此外，Vim 也有个选择（select）模式，与普通的 Windows 编辑器行为较为接近，选择内容后再输入任何内容，将会替换选择的内容。在以可视模式和选择模式之一选定文本块之后，可以使用 Ctrl-G 切换到另一模式。这个模式主要是为了模拟 Windows 编辑器的行为，并不是 Vim 的主要用法，使用它反而会给 Vim 里的自动化带来麻烦，所以我们也就不多作介绍了。</p>
<p>关于 Vim 的模式，我们重点掌握正常模式就可以了，刚刚也说过，Vim 里的大部分操作会在正常模式下完成。如果你做编辑工作时有超过几秒的停顿，就应当考虑按下 Esc 键，回到正常模式。记住，正常模式就是正常情况下你应当处于的模式。😄</p>
<h2>Vim 的键描述体例</h2>
<p>清楚了 Vim 模式之后，我们来对 Vim 里的按键作一下清晰的体例描述，毕竟，Vim 里的键真的有点多。</p>
<p>从现在开始，我会使用 Vim 里的标准键描述方式来讲解。根据 Vim 的一般习惯，我们使用尖括号来描述特殊的输入序列。下面我会提供一个列表，给出常用键的表示方式及在动图中的显示方式。这部分内容不需要记住，你用的时候作为参考就行。</p>
<ul>
<li><code>&lt;Esc&gt;</code> 表示 Esc 键；显示为“⎋”</li>
<li><code>&lt;CR&gt;</code> 表示回车键；显示为“↩”</li>
<li><code>&lt;Space&gt;</code> 表示空格键；显示为“␣”</li>
<li><code>&lt;Tab&gt;</code> 表示 Tab 键；显示为“⇥”</li>
<li><code>&lt;BS&gt;</code> 表示退格键；显示为“⌫”</li>
<li><code>&lt;Del&gt;</code> 表示删除键；显示为“⌦”</li>
<li><code>&lt;lt&gt;</code> 表示 &lt; 键；显示为“&lt;”</li>
<li><code>&lt;Up&gt;</code> 表示光标上移键；显示为“⇡”</li>
<li><code>&lt;Down&gt;</code> 表示光标下移键；显示为“⇣”</li>
<li><code>&lt;Left&gt;</code> 表示光标左移键；显示为“⇠”</li>
<li><code>&lt;Right&gt;</code> 表示光标右移键；显示为“⇢”</li>
<li><code>&lt;PageUp&gt;</code> 表示 Page Up 键；显示为“⇞”</li>
<li><code>&lt;PageDown&gt;</code> 表示 Page Down 键；显示为“⇟”</li>
<li><code>&lt;Home&gt;</code> 表示 Home 键；显示为“↖”</li>
<li><code>&lt;End&gt;</code> 表示 End 键；显示为“↘”</li>
<li><code>&lt;F1&gt;</code> - <code>&lt;F12&gt;</code> 表示功能键 1 到 12；显示为“F1”到“F12”</li>
<li><code>&lt;S-…&gt;</code> Shift 组合键；显示为“⇧”（较少使用，因为我们需要写 <code>!</code> 而不是 <code>&lt;S-1&gt;</code>；和特殊键组合时仍然有用）</li>
<li><code>&lt;C-…&gt;</code> Control 组合键；显示为“⌃”</li>
<li><code>&lt;M-…&gt;</code> Alt 组合键；显示为“⌥”（对于大部分用户，它的原始键名 Meta 应该只具有历史意义）</li>
<li><code>&lt;D-…&gt;</code> Command 组合键；显示为“⌘”（Mac 键盘）</li>
</ul>
<p>现在回到前面的模式部分，我们提到的 Esc、Enter、v、V 和 Ctrl-V，按我们现在的描述惯例，以后就会写成 <code>&lt;Esc&gt;</code>、<code>&lt;CR&gt;</code>、<code>v</code>、<code>V</code> 和 <code>&lt;C-V&gt;</code>。这也是以后在 Vim 里对键进行重映射的写法——如果你还不了解重映射是什么也没关系，我们很快就会讨论到。</p>
<p>这里我要强调一下，对“<code>&lt;</code>”的特殊解释仅在描述输入时生效。在描述命令行和代码时，我们写“<code>&lt;CR&gt;</code>”仍表示四个字符，而非回车键。特别是，如果我们描述的命令行首是“:”，表示这是一个输入 <code>:</code> 开始的 Vim 命令行模式命令（以回车键结束）；如果行首是“/”或“?”，表示这是一个输入 <code>/</code> 或 <code>?</code> 开始的搜索命令（以回车键结束）；如果行首是“<code>$</code>”，表示这是一个在 shell 命令行上输入的命令（以回车键结束），“<code>$</code>”（和后面的空格）不是命令的一部分，通常后续行也不是命令的一部分，除非行尾有“\”或“^”字符，或行首有“<code>$</code>”字符。</p>
<p>也就是说，下面的命令是在 Vim 里输入“<code>:set ft?&lt;CR&gt;</code>”（用来显示当前编辑文件的文件类型）：</p>
<pre><code>:set ft?
</code></pre>
<p><img src="assets/411b4byyfbd7717f2b52246ccyy5b481.gif" alt="Fig2.2" title="Vim 命令示例" /></p>
<p>下面的命令则是在 shell 里输入“<code>which vim&lt;CR&gt;</code>”（用来检查 <code>vim</code> 命令的位置）：</p>
<pre><code>$ which vim
/usr/bin/vim
</code></pre>
<p><img src="assets/80c1875197457b86f94f1216e334dcf3.gif" alt="Fig2.3" title="Shell 命令示例" /></p>
<p>此外，当我用“<a href="https://yianwillis.github.io/vimcdoc/doc/help.html"><code>:help</code></a>”描述帮助命令时，你不仅可以在 Vim 里输入这个命令来得到帮助，也可以点击这个帮助的链接，直接在线查看相应的中文帮助页面。</p>
<p><img src="assets/f58469ab7dbf281bb72896a7a7d8e0cc.jpeg" alt="Fig2.4" title="Vim 的内置帮助功能" /></p>
<p>这节内容不需要死记。建议使用“收藏”功能，这样，你可以在以后碰到不认识的符号标记的时候，返回来查看这一节的内容。</p>
<h2>Vim 的选项和配置</h2>
<p>了解了 Vim 模式和键描述，我们对 Vim 的认识又多了一些，第一步的学习成就达成。要想更好地使用 Vim，下一个关键点就是配置了，接下来我就带你看看 Vim 配置都有哪些需要注意的点。</p>
<p>作为一个可以越用越顺手的应用程序，Vim 是需要配置的。我们才刚开始学习，所以目前我们的配置文件是相当简单的，但随着课程的进展和你使用 Vim 越来越多，你的 Vim 配置文件必然会越变越复杂。我们今天就先来做一些初步的讨论，看看能实际使用的一个最基本 Vim 配置文件是什么样子。</p>
<p>我们上节课已经讨论过，根据 Unix 下的惯例，Vim 的配置文件放在用户的主目录下，文件名通常是 .vimrc；而它在 Windows 下名字是 _vimrc。我们前面给出最基本的配置文件是这个样子的：</p>
<pre><code>set enc=utf-8
set nocompatible
source $VIMRUNTIME/vimrc_example.vim
</code></pre>
<p>如果你熟悉 shell 语法，你肯定能看到不少熟悉的影子在里面。这三行完成了下列功能：</p>
<ul>
<li>设置编辑文件的内码是 UTF-8（非所有平台缺省，但为编辑多语言文件所必需）</li>
<li>设置 Vim 不需要和 vi 兼容（仅为万一起见，目前大部分情况下这是缺省情况）</li>
<li>导入 Vim 的示例配置（这会打开一些有用的选项，如语法加亮、搜索加亮、命令历史、记住上次的文件位置，等等）</li>
</ul>
<p>对于现代 Unix 系统上的 Vim 8，实际上只需要最后一句就足够了。对于现代 Windows 系统上的 Vim 8，中间的这句 <code>set nocompatible</code> 也可以删除。如果你在较老的 Vim 版本上进行配置，那么把这三行全放进去会比较安全。</p>
<p>接下来，我会讲一些基本的配置项，保证你的日常工作流顺畅。它们是：备份和跨会话撤销、鼠标支持、中文支持及图形界面的字体支持。除了字体支持主要牵涉到美观性，其他三项都是对编辑至关重要的基本功能。我们一一来看。</p>
<h3>备份和撤销文件</h3>
<p>上面的基本设置会产生一个有人喜欢、但也有很多人感到困惑的结果：你修改文件时会出现结尾为“~”的文件，有文件名后面直接加“~”的，还有前面加“.”后面加“.un~”的。这是因为在示例配置里，Vim 自动设置了下面两个选项：</p>
<pre><code>set backup
set undofile
</code></pre>
<p>前一个选项使得我们每次编辑会保留上一次的备份文件，后一个选项使得 Vim 在重新打开一个文件时，仍然能够撤销之前的编辑（undo），这就会产生一个保留编辑历史的“撤销文件”（undofile）了。</p>
<p><img src="assets/a2ae45ebdf188cfbe11e9dfd0fb1245e.gif" alt="Fig2.5" title="有撤销文件时，再次打开文件时仍然可以撤销上次的编辑" /></p>
<p>我的通常做法是，不产生备份文件，但保留跨会话撤销编辑的能力；因为有了撤销文件，备份其实也就没有必要了。同时，把撤销文件放在用户个人的特定目录下，既保证了安全，又免去了其他目录下出现不必要文件的麻烦。</p>
<p>要达到这个目的，我在 Linux/macOS 下会这么写：</p>
<pre><code>set nobackup
set undodir=~/.vim/undodir
</code></pre>
<p>在 Windows 下这么写：</p>
<pre><code>set nobackup
set undodir=~\vimfiles\undodir
</code></pre>
<p>无论哪种环境，你都需要创建这个目录。我们可以用下面的命令来让 Vim 在启动时自动创建这个目录：</p>
<pre><code>if !isdirectory(&amp;undodir)
  call mkdir(&amp;undodir, 'p', 0700)
endif
</code></pre>
<p>如果我告诉你， <code>&amp;undodir</code> 代表 <code>undodir</code> 这个选项的值，那么其他代码的基本作用，相信你也一定能看出来了吧？我们暂时就不做进一步分析了。如果你好奇的话，可以提前看一下下面各项的 Vim 帮助文档：</p>
<ul>
<li><a href="https://yianwillis.github.io/vimcdoc/doc/eval.html#isdirectory%28%29"><code>:help isdirectory()</code></a></li>
<li><a href="https://yianwillis.github.io/vimcdoc/doc/eval.html#mkdir%28%29"><code>:help mkdir()</code></a></li>
<li><a href="https://yianwillis.github.io/vimcdoc/doc/eval.html#:call"><code>:help :call</code></a></li>
</ul>
<p>这个跨会话撤销的能力，我还真不知道其他哪个编辑器也有。更妙的是，Vim 还有撤销树的概念，可以帮助你回到任一历史状态。这个我们以后会和相关的插件一起讨论。</p>
<h3>鼠标支持</h3>
<p>我不知道你会不会像某些资深 Vim 用户一样，只用键盘不用鼠标。我反正是做不到的，也没有动力去那样做——毕竟，浪费计算机界一项伟大的发明并不那么有必要😂。手一直在键盘上的本位排（home row）打字当然会更快，但一个程序员看代码的时间比写代码的时间要多得多，而在非线性的跳转任务上，鼠标比键盘更加快，也更加有效。</p>
<p>在 Vim 的终端使用场景下，鼠标的选择有一定的歧义：你希望是使用 Vim 的可视模式选择内容，并且只能在 Vim 里使用呢，还是产生 Vim 外的操作系统的文本选择，用于跟其他应用程序的交互呢？这是一个基本的使用问题，两种情况都可能发生，都需要照顾。</p>
<p>如果你使用 xterm 兼容终端的话，通常的建议是：</p>
<ul>
<li>在不按下修饰键时，鼠标选择产生 Vim 内部的可视选择。</li>
<li>在按下 Shift 时，鼠标选择产生操作系统的文本选择。</li>
</ul>
<p>对于不兼容 xterm、不支持对 Shift 键做这样特殊处理的终端，我们一般会采用一种“绕过”方式，让 Vim 在某种情况下暂时不接管鼠标事件。通常的选择是在命令行模式下不使用鼠标。下面，我们就分这两种情况来配置。</p>
<p>虽然最新的 Vim 缺省配置文件（示例配置文件会包含缺省配置），在大部分情况下已经可以自动设置合适的鼠标选项了，不过为照顾我们课程的三种不同平台，我们还是手工设置一下：</p>
<pre><code>if has('mouse')
  if has('gui_running') || (&amp;term =~ 'xterm' &amp;&amp; !has('mac'))
    set mouse=a
  else
    set mouse=nvi
  endif
endif
</code></pre>
<p>上面代码说的是，如果 Vim 有鼠标支持的话，那在以下任一条件满足时：</p>
<ul>
<li>图形界面正在运行</li>
<li>终端是 xterm 兼容，并且不是 Mac（Mac 上的终端声称自己是 xterm，但行为并不完全相同）</li>
</ul>
<p>我们将启用完全的鼠标支持（mouse=a）。特别是，此时鼠标拖拽就会在 Vim 里使用可视模式选择内容（只能在 Vim 里使用）。而当用户按下 Shift 键时，窗口系统接管鼠标事件，用户可以使用鼠标复制 Vim 窗口里的内容供其他应用程序使用。</p>
<p>否则（非图形界面的的终端，且终端类型不是 xterm），就只在正常模式（n）、可视模式（v）、插入模式（i）中使用鼠标。这意味着，当用户按下 <code>:</code> 键进入命令行模式时，Vim 将不对鼠标进行响应，这时，用户就可以使用鼠标复制 Vim 窗口里的内容到其他应用程序里去了。</p>
<p><img src="assets/e6d582405e3c7e4cbf26f3821yy242df.gif" alt="Fig2.6" title="可视模式的选取和按“:”后的选取" /></p>
<p>非 xterm 的鼠标支持在 macOS 和 Windows 下都有效。但在 Windows 下需要注意的一点是，如果使用非图形界面的 Vim 的话，应当在命令提示符（Command Prompt）的属性里关闭“快速编辑模式”（QuickEdit Mode），否则 Vim 在运行时将无法对鼠标事件进行响应。</p>
<p>鉴于命令提示符的行为有很多怪异和不一致之处，强烈建议你在 Windows 下，要么使用图形界面的 Vim，要么使用 Cygwin/MSYS2 里、运行在 mintty 下的 Vim。</p>
<h3>中文支持</h3>
<p>接下来我和你讲讲中文支持的问题。如果你一直在 UTF-8 下使用中文的话，那这一小节的内容可以跳过。对于大部分在 Unix 下工作的人员，应该是这样的情况。而如果你在 Windows 上工作，或者有需要跟别人交换 GB2312、GBK、GB18030 编码的文本文件，那这部分的内容还是需要看一下的。</p>
<p>完整的 Unicode 历史和原理可以讲上整整一讲，但从实用的角度，我们就简化成下面几条吧：</p>
<ul>
<li>整个世界基本上在向 UTF-8 编码靠拢。</li>
<li>微软由于历史原因，内部使用 UTF-16；UTF-16 可以跟 UTF-8 无损转换。</li>
<li>GB2312、GBK、GB18030 是一系列向后兼容的中文标准编码方式，GB2312 编码的文件是合法的 GBK 文件，GBK 编码的文件是合法的 GB18030 文件。但除了 GB18030，都不能做到跟 UTF-8 无损转换；目前非 UTF-8 的简体中文文本基本上都用 GBK/GB18030 编码（繁体中文文本则以 Big5 居多）。鉴于 GB18030 是国家标准，其他两种编码也和 GB18030 兼容，我们就重点讲如何在 Vim 中支持 GB18030 了。</li>
</ul>
<p>举一个具体的例子，“你好😄”这个字符串，在 UTF-8 编码下是下面 10 个字节（我按字符进行了分组）：</p>
<p><code>e4bda0 e5a5bd f09f9884</code></p>
<p>如果使用 GB18030 编码（GB2312/GBK 不能支持表情字符）的话，会编码成 8 个字节：</p>
<p><code>c4e3 bac3 9439fd30</code></p>
<p>这么看起来，GB18030 处理中文在存储效率上是优势的。但它也有缺点：</p>
<ul>
<li>GBK 外的 Unicode 字符一般需要四字节编码（非中文情况会劣化）</li>
<li>GBK 外的 Unicode 字符跟 Unicode 码点需要查表才能转换（UTF-8 则可以用非常简单的条件判断、移位、与、或操作来转换）</li>
<li>一旦出现文件中有单字节发生损毁，后续的所有中文字符都可能发生紊乱（而 UTF-8 可以在一个字符之后恢复）</li>
</ul>
<p>因此，GB18030 在国际化的软件中不会作为内码来使用，只会是读取/写入文件时使用的转换编码。我们要让 Vim 支持 GB18030 也同样是如此。由于 UTF-8 编码是有明显规律的，并非任意文件都能成功地当成 UTF-8 来解码，我们一般使用的解码顺序是：</p>
<ul>
<li>首先，检查文件是不是有 Unicode 的 BOM（字节顺序标记）字符，有的话按照 BOM 字符来转换文件内容。</li>
<li>其次，检查文件能不能当作 UTF-8 来解码；如果可以，就当作 UTF-8 来解释。</li>
<li>否则，尝试用 GB18030 来解码；如果能成功，就当作 GB18030 来转换文件内容。</li>
<li>最后，如果上面的解码都不成功，就按 Latin1 字符集来解码；由于这是单字节的编码，转换必定成功。</li>
</ul>
<p>事实上，Vim 缺省差不多就是按这样的顺序，但第三步使用何种编码跟系统配置有关。如果你明确需要处理中文，那在配置文件里最好明确写下下面的选项设定：</p>
<pre><code>set fileencodings=ucs-bom,utf-8,gb18030,latin1
</code></pre>
<h3>图形界面的字体配置</h3>
<p>图形界面的 Vim 可以自行配置使用的字体，但在大部分环境里，这只是起到美化作用，而非必需项。不过，对于高分辨率屏幕的 Windows，这是一个必需项：Vim 在 Windows 下缺省使用的不是 TrueType 字体，不进行配置的话，字体会小得没法看。</p>
<p><img src="assets/0a8f9854d5d4ca317b10e9b1753f3c98.png" alt="Fig2.7" title="高分辨率屏下的 Windows 图形界面 Vim" /></p>
<p>在 Windows 的缺省字体里，一般而言，Consolas 和 Courier New 还比较合适。以 Courier New 为例，在 <em>vimrc 里可以这样配置（Windows 上的基本写法是字体名称加冒号、“h”加字号；用“</em>”取代空格，否则空格需要用“\”转义）：</p>
<pre><code>if has('gui_running')
  set guifont=Courier_New:h10
endif
</code></pre>
<p><img src="assets/b9c3a28656a45260a94b4099eab96282.png" alt="Fig2.8" title="设置了 10 磅 Consolas 字体的 Vim" /></p>
<p>字体名称如何写是件平台相关的事（可参见帮助文档“<a href="https://yianwillis.github.io/vimcdoc/doc/gui.html#gui-font"><code>:help gui-font</code></a>”）。如果你不确定怎么写出你需要的字体配置，或者你怎么写都写不对的话，可以先使用图形界面的菜单来选择（通常是“编辑 &gt; 选择字体”；在 MacVim 里是“Edit &gt; Font &gt; Show Fonts”），然后使用命令“<code>:set guifont?</code>”来查看。</p>
<p>注意，Vim 在设置选项时，空格需要用“\”进行转义。比如，如果我们要在 Ubuntu 下把字体设成 10 磅的 DejaVu Sans Mono，就需要写：</p>
<pre><code>  &quot; Linux 和 Windows 不同，不能用 '_' 取代空格
  set guifont=DejaVu\ Sans\ Mono\ 10
</code></pre>
<p>此外，宽字符字体（对我们来讲，就是中文字体了）是可以单独配置的。这可能就更是一件仁者见仁、智者见智的事了。对于纯中文的操作系统，这一般反而是不需要配置的；但如果你的语言设定里，中文不是第一选择的话，就有可能在显示中文时出现操作系统误用日文字体的情况。这时你会想要手工选择一个中文字体，比如在 Ubuntu 下，可以用：</p>
<pre><code>  set guifontwide=Noto\ Sans\ Mono\ CJK\ SC\ 11
</code></pre>
<p>注意，在不同的中英文字体搭配时，并不需要字号相同。事实上，在 Windows 和 Linux 上我通常都是使用不同字号的中英文字体的。</p>
<p><img src="assets/0794053ac4fa28bf9595bfee8a202cb5.gif" alt="Fig2.9" title="Ubuntu 下的 gvim 设置中文字体" /></p>
<p>在上面的动图中，你可以观察到设了中文字体之后，不仅中文字变大，更美观了，“将”、“适”、“关”、“复”、“启”等字的字形也同时发生了变化。</p>
<p>由于字体在各平台上差异较大，字体配置我就不写到 Vim 的参考配置中去了，只把如何选择和配置的方法写出来供你参考。</p>
<h2>内容小结</h2>
<p>好了，这一讲我就讲到这里，我们来做个内容小结。</p>
<p>今天我给出了一张键盘图，带你复习了 Vim 教程的内容，这里我要再强调一遍，这部分的内容如果你还有不熟悉的，一定要再去学习一下 Vim 教程，这段时间我们一定要多花点时间和精力来练习，把这一步跨过去。</p>
<p>掌握了 Vim 教程里的基础信息还远远不够，我们还得了解 Vim 的四种主要模式，你只要记住最重要的就是正常模式就可以了。</p>
<p>最后我带你学习了 Vim 的几个基本配置选项，包括对撤销、鼠标、中文和字体的支持，来满足最基本的编辑需要。最终的 Vim 配置文件可以在 GitHub 上找到：</p>
<p><a href="https://github.com/adah1972/geek_time_vim">https://github.com/adah1972/geek_time_vim</a></p>
<p>关于这个配置文件，我这里做个备注说明：主（master）分支可以用在类 Unix 平台上，windows 分支则用在 Windows 上。适用于今天这一讲的内容标签是 <code>l2-unix</code> 和 <code>l2-windows</code>：你可以用 <code>git checkout l2-unix</code> 或 <code>git checkout l2-windows</code> 来得到相应平台对应本讲的配置文件。</p>
<p>好了，掌握了今天的内容，你就可以用 Vim 做最基本的编辑了。</p>
<h2>课后练习</h2>
<p>请使用本讲的配置文件，并尝试以下操作：</p>
<ul>
<li>退出 Vim 然后重新打开文件，仍然可以撤销上次的编辑。</li>
<li>使用终端的 Vim，在终端里用鼠标复制 Vim 里的文本到另外一个文本编辑器中（仅 Unix 下，可选）。</li>
<li>在 Vim 中使用“<code>:help</code>”命令（大部分环境下也可以使用 <code>&lt;F1&gt;</code> 功能键），尝试查看命令说明，以及使用键盘和鼠标在帮助主题中跳转。</li>
</ul>
<p>如果遇到任何问题，欢迎留言和我讨论。我们下一讲见。</p>
</div>
                        </div>
                        <div>
                            <div style="float: left">
                                <a href="01%20%E5%90%84%E5%B9%B3%E5%8F%B0%E4%B8%8B%E7%9A%84%20Vim%20%E5%AE%89%E8%A3%85%E6%96%B9%E6%B3%95%EF%BC%9A%E4%B8%8A%E8%B7%AF%E5%89%8D%E5%87%86%E5%A4%87%E5%A5%BD%E4%BD%A0%E7%9A%84%E5%AE%9D%E9%A9%AC.md.html">上一页</a>
                            </div>
                            <div style="float: right">
                                <a href="03%20%E6%9B%B4%E5%A4%9A%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%EF%BC%9A%E5%BA%94%E5%AF%B9%E7%A8%8D%E5%A4%8D%E6%9D%82%E7%9A%84%E7%BC%96%E8%BE%91%E4%BB%BB%E5%8A%A1.md.html">下一页</a>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
            <div class="copyright"><p>© 2019 - 2023 <a href="../../cdn-cgi/l/email-protection.html#28444444111c1919181f684f45494144064b4745" target="_blank">Liangliang Lee</a>. Powered by <a href="https://vertx.io/" target="_blank">Vert.x</a> and <a href="https://github.com/kaiiiz/hexo-theme-book" target="_blank">hexo-theme-book</a>.</p></div>
        </div>

        <a class="off-canvas-overlay" onclick="hide_canvas()"></a>
    </div>
<script data-cfasync="false" src="../../cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script defer src="https://static.cloudflareinsights.com/beacon.min.js/vb26e4fa9e5134444860be286fd8771851679335129114" integrity="sha512-M3hN/6cva/SjwrOtyXeUa5IuCT0sedyfT+jK/OV+s+D0RnzrTfwjwJHhd+wYfMm9HJSrZ1IKksOdddLuN6KOzw==" data-cf-beacon='{"rayId":"7af06b854dd824f3","version":"2023.3.0","r":1,"token":"1f5d475227ce4f0089a7cff1ab17c0f5","si":100}' crossorigin="anonymous"></script>
</body>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NPSEEVD756"></script>
<script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
        dataLayer.push(arguments);
    }

    gtag('js', new Date());
    gtag('config', 'G-NPSEEVD756');
    var path = window.location.pathname
    var cookie = getCookie("lastPath");
    console.log(path)
    if (path.replace("/", "") === "") {
        if (cookie.replace("/", "") !== "") {
            console.log(cookie)
            document.getElementById("tip").innerHTML = "<a href='" + cookie + "'>跳转到上次进度</a>"
        }
    } else {
        setCookie("lastPath", path)
    }

    function setCookie(cname, cvalue) {
        var d = new Date();
        d.setTime(d.getTime() + (180 * 24 * 60 * 60 * 1000));
        var expires = "expires=" + d.toGMTString();
        document.cookie = cname + "=" + cvalue + "; " + expires + ";path = /";
    }

    function getCookie(cname) {
        var name = cname + "=";
        var ca = document.cookie.split(';');
        for (var i = 0; i < ca.length; i++) {
            var c = ca[i].trim();
            if (c.indexOf(name) === 0) return c.substring(name.length, c.length);
        }
        return "";
    }

    hljs.initHighlightingOnLoad()

</script>

</html>
